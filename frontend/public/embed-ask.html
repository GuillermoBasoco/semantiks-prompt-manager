<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ask</title>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <style>
      :root { color-scheme: light; }
      body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
      .wrap { padding: 12px; width: 320px; box-sizing: border-box; }
      .input { width: 100%; border: 1px solid #d1d5db; border-radius: 8px; padding: 8px 10px; font-size: 14px; }
      .btn { display: inline-block; background: #111827; color: #fff; border: 1px solid #111827; border-radius: 8px; padding: 8px 12px; font-size: 14px; cursor: pointer; }
      .btn[disabled] { opacity: .7; cursor: default; }
      .label { display: block; font-size: 12px; color: #374151; margin: 0 0 6px; }
      .error { color: #dc2626; font-size: 12px; margin-top: 6px; }
      .answer { margin-top: 8px; border: 1px solid #e5e7eb; border-radius: 8px; background: #fff; padding: 10px; white-space: pre-wrap; font-size: 14px; color: #111827; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <form id="form">
        <label class="label" for="q">Ask the agent</label>
        <input id="q" class="input" placeholder="Type your question" />
        <div style="margin-top:8px">
          <button id="btn" type="submit" class="btn">Ask</button>
        </div>
        <div id="err" class="error" style="display:none"></div>
      </form>
      <div id="ans" class="answer" style="display:none"></div>
    </div>
    <script>
      (function(){
        var form = document.getElementById('form')
        var input = document.getElementById('q')
        var btn = document.getElementById('btn')
        var err = document.getElementById('err')
        var ans = document.getElementById('ans')

        function showError(message){ err.textContent = message; err.style.display = 'block' }
        function clearError(){ err.textContent = ''; err.style.display = 'none' }
        function showAnswer(text){ ans.textContent = text; ans.style.display = 'block' }
        function clearAnswer(){ ans.textContent = ''; ans.style.display = 'none' }

        form.addEventListener('submit', function(e){
          e.preventDefault()
          clearError(); clearAnswer()
          var q = (input.value || '').trim()
          if(!q){ showError('Please enter a question'); return }
          btn.disabled = true; btn.textContent = 'Asking…'
          fetch('/api/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question: q })
          }).then(function(r){ return r.json() }).then(function(data){
            if(data && data.answer){
              showAnswer((data.answer || '') + (data.usedPromptTitle ? '\n\n— Used prompt: ' + data.usedPromptTitle : ''))
              input.value = ''
            } else if (data && data.error){
              showError('Error: ' + data.error)
            } else {
              showError('No answer')
            }
          }).catch(function(){ showError('Network error') })
          .finally(function(){ btn.disabled = false; btn.textContent = 'Ask' })
        })
      })()
    </script>
  </body>
  </html>


